---
title: "Statistical Analyses"
output: 
  html_document:
    code_folding: hide
---


```{r setup, include = FALSE}


library(tidyverse)
library(dplyr)
library(readxl)
library(haven)
library(glmnet)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```


```{r loading data, include = FALSE}
# Loading rat and restaurant data
zipcode_summary <- read_csv("data_small/zipcode_summary.csv") |> 
  mutate(
    zipcode = as.character(zipcode)
  )
```


## Regressing Rat Sightings Count Against Pizza Restaurant Count

For our formal statistical analysis, we analyzed the relationship between pizza restaurant count and number of rat sightings using linear regression.

We regressed number of rat sightings against number of pizza restaurants, and obtained a parameter estimate and associated p-value. We found that for each additional pizza restaurant per zip code, number of rat sightings increased by an average of 1.16 (p-value = 0.001). 

```{r, message = FALSE, warning = FALSE}
# Fitting a linear regression
fit = lm(ratreport_count ~ pizzarestaurant_count, data = zipcode_summary)

# Examining the regression output
fit |> 
  broom::tidy() |> 
  select(term, estimate, p.value) |> 
  knitr::kable(digits = 3)
```

Our regression output suggests that for each additional pizza restaurant per NYC zipcode, the predicted number of rat sightings increases by a 1.16 (p-value = 0.001). The effect is statistically significant, indicating that rats may indeed be pizza lovers. Our analysis showed that number of pizza establishments is positively and significantly associated with number of rat sightings, though the effect is weak.

We additionally considered the r-squared value to assess the fit of our linear model. 

```{r, message = FALSE, warning = FALSE}
# Obtaining r-squared, p-value
fit |> 
  broom::glance() |> 
  select(r.squared, p.value) |> 
  knitr::kable(digits = 3)
```

Our $R^2$ value indicates that only 7% of the variability in number of rat sightings can be explained by the variability in number of pizza restaurants ($R^2$ = 0.07). This means that the majority of variability of rat sightings in explained by factors other than pizza restaurants. 

A plot of residuals against fitted values and our linear model are presented below. 

```{r, message = FALSE, warning = FALSE}
# Looking at the residuals vs. fitted values
zipcode_summary |> 
  modelr::add_residuals(fit) |> 
  modelr::add_predictions(fit) |> 
  ggplot(aes(x = pred, y = resid)) +
  geom_point() +
  labs(
    x = "Predicted values",
    y = "Residuals",
    title = "Predicted Rat Sighting vs Residuals"
 )

# Plotting rat sightings count vs. restaurant count
zipcode_summary |> 
  ggplot(aes(x = pizzarestaurant_count, y = ratreport_count)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  labs(
    x = "# Pizza Restaurants",
    y = "# Rat Sighting Reports",
    title = "Rat Sightings vs. Pizza Restaurants"
 )
```
