<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Visualizing the Data using Heatmaps</title>

<script src="site_libs/header-attrs-2.29/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/darkly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-6.5.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="Final-Code.html">Our Code</a>
</li>
<li>
  <a href="datavisualizations.html">Heat Maps</a>
</li>
<li>
  <a href="plotlyfinal.html">Plots</a>
</li>
<li>
  <a href="rat_stats_report.html">Rat Stats Report</a>
</li>
<li>
  <a href="https://github.com/LindseyAbramson/p8105_FINAL_PIZZA_RATS/tree/main">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Visualizing the Data using Heatmaps</h1>

</div>


<p>To examine how rat sightings and pizza restaurants are spatially
distributed, we obtained a NYC shapefile from NYC government data
portal. This shapefile included the geometric shapes of each zipcode
area and an attribute table that included the zipcode numbers for each
shape. We merged this shapefile with our cleaned dataset using the
common variable of zipcodes.</p>
<pre class="r"><code># Zip code shapefile
zip_nyc =
  st_read(&quot;maps/MODZCTA_2010.shp&quot;) |&gt; 
  rename(zipcode = MODZCTA) |&gt; 
  select(zipcode, geometry)

# Basic plot
basic = 
  ggplot() +
  geom_sf(data = zip_nyc)

# Dissolving shapefile for just NYC boundary
NYC &lt;- st_union(zip_nyc)

# Loading rat and restaurant data
zipcode_summary &lt;- read_csv(&quot;data_small/zipcode_summary.csv&quot;) |&gt; 
  mutate(
    zipcode = as.character(zipcode)
  )

# Joining rat and restaurant data with shapefile. Now, I have one file with the geometries for the map, and rat and pizza count data.
nyc_rat_pizza =
  zip_nyc |&gt; 
  left_join(zipcode_summary, by = &quot;zipcode&quot;)</code></pre>
<div id="rat-sightings-map" class="section level3">
<h3>Rat Sightings Map</h3>
<p>To create a heatmap of rat sightings across NYC, we first had to
assess the distribution of the <code>ratreport_count</code> variable in
our dataset. As demonstrated below, <code>rareport_count</code> is right
skewed, with most zipcodes reporting anywhere from 0 to 200 sightings.
Due to the skewed nature of this variable, when categorizing our data
for the heatmap, we used a natural breaks jenks approach to ensure
zipcodes with similar rat sightings are visually represented using the
same color.</p>
<pre class="r"><code># Examining distribution to figure out how to categorize data
nyc_rat_pizza |&gt; 
  ggplot(aes(x = ratreport_count)) +
  geom_histogram(fill = &quot;darkgreen&quot;, color = &quot;white&quot;) +
  labs(
    x = &quot;# of Rat Sightings&quot;,
    y = &quot;Count&quot;,
    title = &quot;Distribution of Rat Sightings Variable&quot;
  )</code></pre>
<p><img src="datavisualizations_files/figure-html/Rat%20sightings%20distribution-1.png" width="90%" /></p>
<p>The final step was to refine the formatting and styling of the
heatmap to ensure clear and effective visualization.</p>
<pre class="r"><code># Formatted Rat Map
ggplot() +
  geom_sf(                            # setting rat counts as my fill             
    data = nyc_rat_pizza,
    aes(fill = ratreport_count),
    color = &quot;white&quot;,
    linewidth = .05
  )  +
  scale_fill_fermenter(               # indicating the color palette for the rat sightings map
    direction = 1,
    palette = &quot;Greens&quot;,
    breaks = breaks_rat
  ) +
  geom_sf(                            # adding a thin black outline around map
    data = NYC,
    fill = NA,
    color = &quot;black&quot;,
    linewidth = 0.03
  ) +
  labs(                                # adding title and subtitle 
    title = &quot;Number of Rat Sightings in \nNew York City by Zipcode, 2025&quot;,
    subtitle = &quot;Sightings as of November 2025&quot;, 
    fill = &quot;Number of Sightings&quot;
  ) +
  theme_void() +
  theme(                             # title and subtitle formatting and placement
    plot.title = element_text(face = &quot;bold&quot;, size = 13, family = &quot;sans&quot;, vjust = -20),
    plot.subtitle = element_text(face = &quot;italic&quot;, size = 11, vjust = -3.5),
    legend.title = element_text(size = 10),
    legend.position = &quot;inside&quot;,
    legend.position.inside = c(0.2, 0.6),
    legend.key.size = unit(.4, &#39;cm&#39;),
    plot.margin = margin(0, 0, 0, 0),        
    panel.spacing = unit(0, &quot;pt&quot;)            
  ) + 
  annotation_scale(                   # adding a scale bar
    style = &quot;ticks&quot;,   
    pad_x = unit(1.4, &quot;in&quot;),
    pad_y = unit(.3, &quot;in&quot;),
    unit_category = &quot;imperial&quot;
  ) +
  annotation_north_arrow(             # adding a north arrow
    height = unit(.8, &quot;cm&quot;),
    width = unit(1, &quot;cm&quot;),
    pad_x = unit(1, &quot;in&quot;), 
    pad_y = unit(0.2, &quot;in&quot;),
    style = north_arrow_minimal 
    )  -&gt; map_rat</code></pre>
</div>
<div id="pizza-restuarants-map" class="section level3">
<h3>Pizza Restuarants Map</h3>
<p>A similar approach was taken to create the pizza restaurants map. We
first assessed the distribution of the
<code>pizzarestaurant_count</code> variable in our dataset. We found
that this variable was also right skewed, with most zip codes ranging
from 0-50 pizza restaurants. We also used natural breaks jenks to
categorize <code>pizzarestaurant_count</code>.</p>
<pre class="r"><code># Examine distribution to figure out how to categorize data
nyc_rat_pizza |&gt; 
  ggplot(aes(x = pizzarestaurant_count)) +
  geom_histogram(fill = &quot;darkred&quot;, color = &quot;white&quot;) +
  labs(
    x = &quot;# of Pizza Restaurants&quot;,
    y = &quot;Count&quot;,
    title = &quot;Distribution of Pizza Resturants Variable&quot;
  )</code></pre>
<p><img src="datavisualizations_files/figure-html/restaurant%20distribution-1.png" width="90%" /></p>
<p>The final step was to refine the formatting and styling of the
heatmap to ensure clear and effective visualization.</p>
<pre class="r"><code># Formatted Pizza Map
ggplot() +
  geom_sf(                              # setting pizza counts as my fill
    data = nyc_rat_pizza,
    aes(fill = pizzarestaurant_count),
    color = &quot;white&quot;,
    linewidth = .05
  )  +
  scale_fill_fermenter(                # indicating color palette
    direction = 1,
    palette = &quot;Reds&quot;,
    breaks = breaks_pizza
  ) +
  geom_sf(                             # adding black border around map
    data = NYC,
    fill = NA,
    color = &quot;black&quot;,
    linewidth = 0.03
  )  +
  labs(                                # adding title and subtitle 
    title = &quot;Number of Pizza Restaurants \nin New York City by Zipcode, 2025&quot;,
    subtitle = &quot;Includes by-the-slice and\nsit-down pizza restuarants&quot;, 
    fill = &quot;Number of Pizza Restaurants&quot;
  ) +
  theme_void() +
  theme(                              # formatting and placement of title, subtitle, legend
    plot.title = element_text(face = &quot;bold&quot;, size = 13, family = &quot;sans&quot;, vjust = -20),
    plot.subtitle = element_text(face = &quot;italic&quot;, size = 11, vjust = -25),
    legend.title = element_text(size = 10),
    legend.position = &quot;inside&quot;,
    legend.position.inside = c(0.2, 0.6),
    legend.key.size = unit(.4, &#39;cm&#39;),
    plot.margin = margin(0, 0, 0, 0),        
    panel.spacing = unit(0, &quot;pt&quot;)            
  ) +
  annotation_scale(                   # adding a scale bar
    style = &quot;ticks&quot;,   
    pad_x = unit(1.4, &quot;in&quot;),
    pad_y = unit(.3, &quot;in&quot;),
    unit_category = &quot;imperial&quot;
  ) +
  annotation_north_arrow(             # adding a north arrow
    height = unit(.8, &quot;cm&quot;),
    width = unit(1, &quot;cm&quot;),
    pad_x = unit(1, &quot;in&quot;), 
    pad_y = unit(0.2, &quot;in&quot;),
    style = north_arrow_minimal 
    )  -&gt; map_pizza</code></pre>
</div>
<div id="results" class="section level3">
<h3>Results</h3>
<p>These maps illustrate the spatial distribution of rat sightings and
pizza restaurants across New York City zipcodes. Most rat sightings are
concentrated in central Brooklyn, particularly in neighborhoods such as
Flatbush, Prospect Heights, and Bedford-Stuyvesant. A few zipcodes in
the West Bronx and around Morningside Heights also show elevated rat
activity.</p>
<p>In contrast, the distribution of pizza restaurants is more dispersed.
Zipcodes with the highest numbers of pizza restaurants are spread across
Manhattan, Queens, Brooklyn, and the Bronx, in neighborhoods such as
Hellâ€™s Kitchen, Jackson Heights, Flatbush, and Long Island City.</p>
<p>There is only one zipcode with both a high number of rat sightings
and a high number of pizza restaurants (11226, Flatbush). This suggests
that pizza restaurant count alone may not be a strong predictor of rat
activity. Other neighborhood-level factors must be contributing to
variation in rat sightings across NYC.</p>
<pre class="r"><code># presenting map
knitr::include_graphics(&quot;datavisualizations_files/nyc_maps.png&quot;)</code></pre>
<p><img src="datavisualizations_files/nyc_maps.png" width="120%" /></p>
<p><em>Missing data represented using gray fill</em></p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
