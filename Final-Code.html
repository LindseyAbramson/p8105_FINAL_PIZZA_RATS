<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Final-Code</title>

<script src="site_libs/header-attrs-2.29/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/darkly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="Final-Code.html">Our Code</a>
</li>
<li>
  <a href="datavisualizations.html">Heat Maps</a>
</li>
<li>
  <a href="plotlyfinal.html">Plots</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">




</div>


<div id="final-code" class="section level1">
<h1>Final Code</h1>
<p>2025-11-21</p>
<div id="import-datasets" class="section level2">
<h2>Import Datasets</h2>
<p>Please note for all those who use this… run once.</p>
<pre class="r"><code>rat_df =
read_csv(&quot;data_not_for_github/NYC_rats.csv&quot;) |&gt;
janitor::clean_names() |&gt;
mutate(created_date = ymd_hms(created_date)) |&gt;
filter(year(created_date) == 2025) |&gt;
  rename(zipcode = incident_zip) |&gt;
  select(created_date, zipcode, borough, latitude, longitude, location_type)

restaurant_df =
read_csv(&quot;data_not_for_github/NYC_restaurant.csv&quot;) |&gt;
janitor::clean_names() |&gt;
mutate(inspection_date = mdy(inspection_date))   |&gt;
filter(year(inspection_date) == 2025) |&gt;
  select(dba, boro, zipcode, inspection_date, violation_description, grade, latitude, longitude)


dir.create(&quot;data_small&quot;, showWarnings = FALSE)
write_csv(rat_df, &quot;data_small/rat_df_2025_small.csv&quot;)
write_csv(restaurant_df, &quot;data_small/restaurant_df_2025_small.csv&quot;)</code></pre>
<pre class="r"><code>rat_df &lt;- read_csv(&quot;data_small/rat_df_2025_small.csv&quot;)</code></pre>
<pre><code>## Rows: 18978 Columns: 6
## ── Column specification ───────
## Delimiter: &quot;,&quot;
## chr  (2): borough, location_type
## dbl  (3): zipcode, latitude, longitude
## dttm (1): created_date
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre class="r"><code>restaurant_df &lt;- read_csv(&quot;data_small/restaurant_df_2025_small.csv&quot;)</code></pre>
<pre><code>## Rows: 84603 Columns: 8
## ── Column specification ───────
## Delimiter: &quot;,&quot;
## chr  (4): dba, boro, violation_description, grade
## dbl  (3): zipcode, latitude, longitude
## date (1): inspection_date
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre class="r"><code># Limit to only pizza joints
pizza_df =
  restaurant_df |&gt;
  filter((str_detect(str_to_lower(dba), 
                    &quot;pizza|pizzeria|slice&quot;)))</code></pre>
<p>Our decision to use only 2025 data provides a current snapshot of rat
sightings and pizza restaurant inspections in NYC. This ensures
relevance but means we cannot analyze longitudinal trends in rat
populations, and some restaurants may be absent from our dataset if they
weren’t inspected during this specific time period. Our search terms for
pizza restuarants include “pizza”, “pizzeria”, and “slice”. Ideally this
would cover all pizza joints but we recognize that some may fall under
various other names!</p>
</div>
<div id="merge-summaries-by-zipcode" class="section level2">
<h2>Merge Summaries by Zipcode</h2>
<p>Note that we can run our analyses without doing this, but this
simplifies our data down to just counts by zipcode.THIS DOES NOT INCLUDE
LAT AND LONG….for mapping purposes may need to use individual datasets
above!</p>
<pre class="r"><code># Count rats per zipcode
rat_summary &lt;- rat_df |&gt;
  group_by(zipcode) |&gt;
  summarise(ratreport_count = n(), .groups = &quot;drop&quot;)

# Count restaurants per zipcode by grade
pizza_summary &lt;- pizza_df |&gt;
  group_by(zipcode) |&gt;
  summarise(
    pizzarestaurant_count = n(),
    pizza_A = sum(grade == &quot;A&quot;, na.rm = TRUE),
    pizza_B = sum(grade == &quot;B&quot;, na.rm = TRUE),
    pizza_C = sum(grade == &quot;C&quot;, na.rm = TRUE)
  , .groups = &quot;drop&quot;)

# Join
zipcode_summary &lt;- rat_summary |&gt;
  left_join(pizza_summary, by = &quot;zipcode&quot;)

# Saving zipcode_summary to directory
write_csv(zipcode_summary, &quot;data_small/zipcode_summary.csv&quot;)</code></pre>
</div>
<div id="regressing-rat-sightings-count-against-pizza-restaurant-count"
class="section level2">
<h2>Regressing Rat Sightings Count Against Pizza Restaurant Count</h2>
<pre class="r"><code># Fitting a linear regression
fit = lm(ratreport_count ~ pizzarestaurant_count, data = zipcode_summary)

# Examining the regression output
fit |&gt; 
  broom::tidy() |&gt; 
  select(term, estimate, p.value) |&gt; 
  knitr::kable(digits = 3)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">78.925</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">pizzarestaurant_count</td>
<td align="right">1.158</td>
<td align="right">0.001</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Obtaining r-squared, p-value
fit |&gt; 
  broom::glance() |&gt; 
  select(r.squared, p.value) |&gt; 
  knitr::kable(digits = 3)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">r.squared</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.07</td>
<td align="right">0.001</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Looking at the residuals vs. fitted values
zipcode_summary |&gt; 
  modelr::add_residuals(fit) |&gt; 
  modelr::add_predictions(fit) |&gt; 
  ggplot(aes(x = pred, y = resid)) +
  geom_point() </code></pre>
<pre><code>## Warning: Removed 24 rows containing
## missing values or values
## outside the scale range
## (`geom_point()`).</code></pre>
<p><img src="Final-Code_files/figure-gfm/unnamed-chunk-4-1.png" width="90%" /></p>
<pre class="r"><code># Plotting rat sightings count vs. restaurant count
zipcode_summary |&gt; 
  ggplot(aes(x = pizzarestaurant_count, y = ratreport_count)) +
  geom_point() +
  geom_smooth(method = &quot;lm&quot;, se = TRUE) +
  labs(
    x = &quot;# Pizza Restaurants&quot;,
    y = &quot;# Rat Sighting Reports&quot;,
    title = &quot;Rat Sightings vs. Pizza Restaurants&quot;
 )</code></pre>
<pre><code>## `geom_smooth()` using formula
## = &#39;y ~ x&#39;

## Warning: Removed 24 rows containing
## non-finite outside the scale
## range (`stat_smooth()`).
## Removed 24 rows containing
## missing values or values
## outside the scale range
## (`geom_point()`).</code></pre>
<p><img src="Final-Code_files/figure-gfm/unnamed-chunk-4-2.png" width="90%" /></p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
