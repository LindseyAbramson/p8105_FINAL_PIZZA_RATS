<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />



<meta name="date" content="2025-11-21" />

<title>Final Code</title>

<script src="site_libs/header-attrs-2.29/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/darkly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-6.5.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="Final-Code.html">Our Code</a>
</li>
<li>
  <a href="datavisualizations.html">Heat Maps</a>
</li>
<li>
  <a href="plotlyfinal.html">Plots</a>
</li>
<li>
  <a href="rat_stats_report.html">Rat Stats Report</a>
</li>
<li>
  <a href="https://github.com/LindseyAbramson/p8105_FINAL_PIZZA_RATS/tree/main">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Final Code</h1>
<h4 class="date">2025-11-21</h4>

</div>


<pre class="r"><code>install.packages(&quot;sf&quot;)           # gis package
install.packages(&quot;RColorBrewer&quot;) # color palettes
install.packages(&quot;classInt&quot;)     # creates breaks in the distribution
install.packages(&quot;ggspatial&quot;)    # scale bars and north arrows

library(tidyverse)
library(dplyr)
library(readxl)
library(haven)
library(glmnet)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = &quot;90%&quot;
)

theme_set(theme_minimal() + theme(legend.position = &quot;bottom&quot;))

options(
  ggplot2.continuous.colour = &quot;viridis&quot;,
  ggplot2.continuous.fill = &quot;viridis&quot;
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d</code></pre>
<div id="import-datasets" class="section level2">
<h2>Import Datasets</h2>
<p>Please note for all those who use this… run once.</p>
<pre class="r"><code>rat_df =
read_csv(&quot;data_not_for_github/NYC_rats.csv&quot;) |&gt;
janitor::clean_names() |&gt;
mutate(created_date = ymd_hms(created_date)) |&gt;
filter(year(created_date) == 2025) |&gt;
  rename(zipcode = incident_zip) |&gt;
  select(created_date, zipcode, borough, latitude, longitude, location_type)

restaurant_df =
read_csv(&quot;data_not_for_github/NYC_restaurant.csv&quot;) |&gt;
janitor::clean_names() |&gt;
mutate(inspection_date = mdy(inspection_date))   |&gt;
filter(year(inspection_date) == 2025) |&gt;
  select(dba, boro, zipcode, inspection_date, violation_description, grade, latitude, longitude)


dir.create(&quot;data_small&quot;, showWarnings = FALSE)
write_csv(rat_df, &quot;data_small/rat_df_2025_small.csv&quot;)
write_csv(restaurant_df, &quot;data_small/restaurant_df_2025_small.csv&quot;)</code></pre>
<pre class="r"><code>rat_df &lt;- read_csv(&quot;data_small/rat_df_2025_small.csv&quot;)
restaurant_df &lt;- read_csv(&quot;data_small/restaurant_df_2025_small.csv&quot;)

# Limit to only pizza joints
pizza_df =
  restaurant_df |&gt;
  filter((str_detect(str_to_lower(dba), 
                    &quot;pizza|pizzeria|slice&quot;)))</code></pre>
<p>Our decision to use only 2025 data provides a current snapshot of rat
sightings and pizza restaurant inspections in NYC. This ensures
relevance but means we cannot analyze longitudinal trends in rat
populations, and some restaurants may be absent from our dataset if they
weren’t inspected during this specific time period. Our search terms for
pizza restuarants include “pizza”, “pizzeria”, and “slice”. Ideally this
would cover all pizza joints but we recognize that some may fall under
various other names!</p>
</div>
<div id="merge-summaries-by-zipcode" class="section level2">
<h2>Merge Summaries by Zipcode</h2>
<p>Note that we can run our analyses without doing this, but this
simplifies our data down to just counts by zipcode.</p>
<pre class="r"><code># Count rats per zipcode
rat_summary &lt;- rat_df |&gt;
  group_by(zipcode) |&gt;
  summarise(ratreport_count = n(), .groups = &quot;drop&quot;)

# Count restaurants per zipcode by grade
pizza_summary &lt;- pizza_df |&gt;
  group_by(zipcode) |&gt;
  summarise(
    pizzarestaurant_count = n(),
    pizza_A = sum(grade == &quot;A&quot;, na.rm = TRUE),
    pizza_B = sum(grade == &quot;B&quot;, na.rm = TRUE),
    pizza_C = sum(grade == &quot;C&quot;, na.rm = TRUE)
  , .groups = &quot;drop&quot;)

# Join
zipcode_summary &lt;- rat_summary |&gt;
  left_join(pizza_summary, by = &quot;zipcode&quot;)

# Saving zipcode_summary to directory
write_csv(zipcode_summary, &quot;data_small/zipcode_summary.csv&quot;)</code></pre>
</div>
<div id="regressing-rat-sightings-count-against-pizza-restaurant-count"
class="section level2">
<h2>Regressing Rat Sightings Count Against Pizza Restaurant Count</h2>
<pre class="r"><code># Fitting a linear regression
fit = lm(ratreport_count ~ pizzarestaurant_count, data = zipcode_summary)

# Examining the regression output
fit |&gt; 
  broom::tidy() |&gt; 
  select(term, estimate, p.value) |&gt; 
  knitr::kable(digits = 3)</code></pre>
<p>For each additional pizza restaurant per NYC zipcode, the predicted
number of rat sightings increases by a 1.16 (p-value = 0.001). The
effect is statistically significant, indicating that rats may indeed be
pizza lovers.</p>
<pre class="r"><code># Obtaining r-squared, p-value
fit |&gt; 
  broom::glance() |&gt; 
  select(r.squared, p.value) |&gt; 
  knitr::kable(digits = 3)</code></pre>
<p>Only 7% of the variability in number of rat sightings can be
explained by the variability in number of pizza restaurants (<span
class="math inline">\(R^2\)</span> = 0.07).</p>
<pre class="r"><code># Looking at the residuals vs. fitted values
zipcode_summary |&gt; 
  modelr::add_residuals(fit) |&gt; 
  modelr::add_predictions(fit) |&gt; 
  ggplot(aes(x = pred, y = resid)) +
  geom_point() 

# Plotting rat sightings count vs. restaurant count
zipcode_summary |&gt; 
  ggplot(aes(x = pizzarestaurant_count, y = ratreport_count)) +
  geom_point() +
  geom_smooth(method = &quot;lm&quot;, se = TRUE) +
  labs(
    x = &quot;# Pizza Restaurants&quot;,
    y = &quot;# Rat Sighting Reports&quot;,
    title = &quot;Rat Sightings vs. Pizza Restaurants&quot;
 )</code></pre>
</div>
<div id="heat-maps-code" class="section level2">
<h2>Heat Maps Code</h2>
<p>First I load the relevant datasets, and load a blank shapefile with
NYC zipcodes.</p>
<pre class="r"><code># Zip code shapefile
zip_nyc =
  st_read(&quot;maps/MODZCTA_2010.shp&quot;) |&gt; 
  rename(zipcode = MODZCTA) |&gt; 
  select(zipcode, geometry)

# Basic plot
ggplot() +
  geom_sf(data = zip_nyc)

# Dissolving shapefile for just NYC boundary
NYC &lt;- st_union(zip_nyc)

# Loading rat and restaurant data
zipcode_summary &lt;- read_csv(&quot;data_small/zipcode_summary.csv&quot;) |&gt; 
  mutate(
    zipcode = as.character(zipcode)
  )

# Joining rat and restaurant data with shapefile. Now, I have one file with the geometries for the map, and rat and pizza count data.
nyc_rat_pizza =
  zip_nyc |&gt; 
  left_join(zipcode_summary, by = &quot;zipcode&quot;)</code></pre>
<p>Next, I create the heatmap for rat sightings.</p>
<pre class="r"><code># Rat count base map
ggplot() +
  geom_sf(
    data = nyc_rat_pizza,
    aes(fill = ratreport_count),
    color = &quot;black&quot;,
    linewidth = .2
  ) 


# Looking at the different color palette options 
display.brewer.all(type = &quot;seq&quot;)

# Examining distribution to figure out how to categorize data
nyc_rat_pizza |&gt; 
  ggplot(aes(x = ratreport_count)) +
  geom_histogram()

# Right skewed data so using natural break jenks as opposed to quantiles
breaks_rat &lt;- classIntervals(nyc_rat_pizza$ratreport_count, n = 5, style = &quot;jenks&quot;)$brks
print(breaks_rat)

# Formatted Rat Map
ggplot() +
  geom_sf(                            # setting rat counts as my fill             
    data = nyc_rat_pizza,
    aes(fill = ratreport_count),
    color = &quot;white&quot;,
    linewidth = .05
  )  +
  scale_fill_fermenter(               # indicating the color palette for the rat sightings map
    direction = 1,
    palette = &quot;Greens&quot;,
    breaks = breaks_rat
  ) +
  geom_sf(                            # adding a thin black outline around map
    data = NYC,
    fill = NA,
    color = &quot;black&quot;,
    linewidth = 0.03
  ) +
  labs(                                # adding title and subtitle 
    title = &quot;Number of Rat Sightings in \nNew York City by Zipcode, 2025&quot;,
    subtitle = &quot;Sightings as of November 2025&quot;, 
    fill = &quot;Number of Sightings&quot;
  ) +
  theme_void() +
  theme(                             # title and subtitle formatting and placement
    plot.title = element_text(face = &quot;bold&quot;, size = 13, family = &quot;sans&quot;, vjust = -20),
    plot.subtitle = element_text(face = &quot;italic&quot;, size = 11, vjust = -3.5),
    legend.title = element_text(size = 10),
    legend.position = &quot;inside&quot;,
    legend.position.inside = c(0.2, 0.6),
    legend.key.size = unit(.4, &#39;cm&#39;),
    plot.margin = margin(0, 0, 0, 0),        
    panel.spacing = unit(0, &quot;pt&quot;)            
  ) + 
  annotation_scale(                   # adding a scale bar
    style = &quot;ticks&quot;,   
    pad_x = unit(1.4, &quot;in&quot;),
    pad_y = unit(.3, &quot;in&quot;),
    unit_category = &quot;imperial&quot;
  ) +
  annotation_north_arrow(             # adding a north arrow
    height = unit(.8, &quot;cm&quot;),
    width = unit(1, &quot;cm&quot;),
    pad_x = unit(1, &quot;in&quot;), 
    pad_y = unit(0.2, &quot;in&quot;),
    style = north_arrow_minimal 
    )  -&gt; map_rat</code></pre>
<p>Here I create a heatmap for pizza restaurant counts per zipcode.</p>
<pre class="r"><code># Pizza count base map
ggplot() +
  geom_sf(
    data = nyc_rat_pizza,
    aes(fill = pizzarestaurant_count),
    color = &quot;black&quot;,
    linewidth = .2
  ) 


# Select color palette and our breaks: 
display.brewer.all(type = &quot;seq&quot;)

# Examine distribution to figure out how to categorize data
nyc_rat_pizza |&gt; 
  ggplot(aes(x = pizzarestaurant_count)) +
  geom_histogram()

# Right skewed so using natural break jenks
breaks_pizza &lt;- classIntervals(nyc_rat_pizza$pizzarestaurant_count, n = 5, style = &quot;jenks&quot;)$brks
print(breaks_pizza)

# Formatted Pizza Map
ggplot() +
  geom_sf(                              # setting pizza counts as my fill
    data = nyc_rat_pizza,
    aes(fill = pizzarestaurant_count),
    color = &quot;white&quot;,
    linewidth = .05
  )  +
  scale_fill_fermenter(                # indicating color palette
    direction = 1,
    palette = &quot;Reds&quot;,
    breaks = breaks_pizza
  ) +
  geom_sf(                             # adding black border around map
    data = NYC,
    fill = NA,
    color = &quot;black&quot;,
    linewidth = 0.03
  )  +
  labs(                                # adding title and subtitle 
    title = &quot;Number of Pizza Restaurants \nin New York City by Zipcode, 2025&quot;,
    subtitle = &quot;Includes by-the-slice and\nsit-down pizza restuarants&quot;, 
    fill = &quot;Number of Pizza Restaurants&quot;
  ) +
  theme_void() +
  theme(                              # formatting and placement of title, subtitle, legend
    plot.title = element_text(face = &quot;bold&quot;, size = 13, family = &quot;sans&quot;, vjust = -20),
    plot.subtitle = element_text(face = &quot;italic&quot;, size = 11, vjust = -25),
    legend.title = element_text(size = 10),
    legend.position = &quot;inside&quot;,
    legend.position.inside = c(0.2, 0.6),
    legend.key.size = unit(.4, &#39;cm&#39;),
    plot.margin = margin(0, 0, 0, 0),        
    panel.spacing = unit(0, &quot;pt&quot;)            
  ) +
  annotation_scale(                   # adding a scale bar
    style = &quot;ticks&quot;,   
    pad_x = unit(1.4, &quot;in&quot;),
    pad_y = unit(.3, &quot;in&quot;),
    unit_category = &quot;imperial&quot;
  ) +
  annotation_north_arrow(             # adding a north arrow
    height = unit(.8, &quot;cm&quot;),
    width = unit(1, &quot;cm&quot;),
    pad_x = unit(1, &quot;in&quot;), 
    pad_y = unit(0.2, &quot;in&quot;),
    style = north_arrow_minimal 
    )  -&gt; map_pizza</code></pre>
<p>I join the two heatmaps and save as a combined map.</p>
<pre class="r"><code># combining both maps to view side by side
map_rat + map_pizza -&gt; combined_plot
print(combined_plot)

# saving the combined map
ggsave(
  &quot;datavisualizations_files/nyc_maps.png&quot;, combined_plot,width = 12, height = 7,   
  dpi = 320, bg = &quot;white&quot;
)</code></pre>
<pre class="r"><code># presenting map
knitr::include_graphics(&quot;datavisualizations_files/nyc_maps.png&quot;)</code></pre>
</div>
<div id="plots-code" class="section level2">
<h2>Plots Code</h2>
<style>
h1.title {
  text-align: center;
  font-size: 32px;
  font-weight: 700;
  margin-top: 20px;
}
</style>
<style>
h1.title, h3.subtitle {
  text-align: center;
}
</style>
<pre class="r"><code># Fit the model
fit &lt;- lm(ratreport_count ~ pizzarestaurant_count, data = zipcode_summary)

# Create predicted values for a smooth regression line
regline_df &lt;- tibble(
  pizzarestaurant_count = seq(
    min(zipcode_summary$pizzarestaurant_count, na.rm = TRUE),
    max(zipcode_summary$pizzarestaurant_count, na.rm = TRUE),
    length.out = 200
  )
) |&gt;
  mutate(
    pred = predict(fit, newdata = cur_data_all())
  )

# Base scatterplot
p =
  zipcode_summary |&gt;
  ggplot(aes(
    x = pizzarestaurant_count,
    y = ratreport_count,
    color = ratreport_count,
    text = paste0(
      &quot;Zipcode: &quot;, zipcode, &quot;&lt;br&gt;&quot;,
      &quot;Rat reports: &quot;, ratreport_count, &quot;&lt;br&gt;&quot;,
      &quot;Pizza restaurants: &quot;, pizzarestaurant_count
    )
  )) +
  geom_point(size = 2, alpha = 0.8) +
  # Add the regression line manually
  geom_line(
    data = regline_df,
    aes(
      x = pizzarestaurant_count,
      y = pred
    ),
    inherit.aes = FALSE,
    color = &quot;black&quot;,
    linewidth = 1
  ) +
  scale_color_viridis_c(option = &quot;plasma&quot;) +
  labs(
    title = &quot;Rat Sightings vs Pizza Restaurants by Zipcode&quot;,
    x = &quot;# Pizza Restaurants&quot;,
    y = &quot;# Rat Sighting Reports&quot;,
    color = &quot;Rat Count&quot;
  ) +
  theme_minimal()

plotly::ggplotly(p, tooltip = &quot;text&quot;)</code></pre>
<p>This scatterplot displays the relationship between pizza restaurant
count and rat sightings for every zipcode. Each point represents one
zipcode, and the color indicates the number of rat reports. Most points
cluster at lower values for both variables, while a few zipcodes show
very high rat activity. The wide spread of the points shows that the
relationship is weak and that many other factors likely contribute to
rat sightings.</p>
<pre class="r"><code>zipcode_summary |&gt;
  slice_max(ratreport_count, n = 10) |&gt;
  ggplot(aes(x = reorder(zipcode, ratreport_count), y = ratreport_count)) +
  geom_col(fill = &quot;firebrick&quot;, alpha = 0.85) +
  coord_flip() +
  labs(
    title = &quot;Top 10 Zipcodes with Highest Rat Sightings&quot;,
    x = &quot;Zipcode&quot;,
    y = &quot;Rat Sighting Reports&quot;
  ) +
  theme_minimal()</code></pre>
<p>This bar chart highlights the ten zipcodes with the highest number of
rat sightings. A few locations stand out with much higher counts than
the rest of the city. These areas may have environmental or structural
conditions that support larger rat populations. This chart helps
identify where rat issues are most concentrated.</p>
<pre class="r"><code>zipcode_summary |&gt; 
  slice_max(pizzarestaurant_count, n = 10) |&gt; 
  ggplot(aes(x = reorder(zipcode, pizzarestaurant_count),
             y = pizzarestaurant_count)) +
  geom_col(fill = &quot;orange&quot;, alpha = 0.9) +
  coord_flip() +
  labs(
    title = &quot;Top 10 Zipcodes with Most Pizza Restaurants&quot;,
    x = &quot;Zipcode&quot;,
    y = &quot;# Pizza Restaurants&quot;
  ) +
  theme_minimal()</code></pre>
<p>This bar chart shows the ten zipcodes with the highest number of
pizza restaurants. These areas often have dense food activity and heavy
foot traffic. When compared with the rat sightings chart, it becomes
clear that zipcodes with many pizza restaurants do not always have the
highest rat activity. This supports the idea that pizza restaurant
density is not a strong predictor of rat reports across zipcodes.</p>
<pre class="r"><code># Fit the model
fit &lt;- lm(ratreport_count ~ pizzarestaurant_count, data = zipcode_summary)

# Get R squared
r2_value &lt;- summary(fit)$r.squared
r2_label &lt;- paste0(&quot;R squared: &quot;, round(r2_value, 3))

# Build the static ggplot with R squared in the title
p_regline =
  zipcode_summary |&gt;
  ggplot(aes(x = pizzarestaurant_count, y = ratreport_count)) +
  geom_smooth(method = &quot;lm&quot;, se = TRUE, color = &quot;darkblue&quot;) +
  labs(
    title = paste(&quot;Regression Line: Rat Sightings vs Pizza Restaurants&quot;, &quot;\n&quot;, r2_label),
    x = &quot;# Pizza Restaurants&quot;,
    y = &quot;Predicted Rat Sighting Reports&quot;
  ) +
  theme_minimal()

# Convert to interactive plotly
plotly::ggplotly(p_regline)</code></pre>
<p>This plot shows the estimated linear relationship between the number
of pizza restaurants in a zipcode and the predicted number of rat
sightings. The line slopes upward, which suggests a small positive
association. The confidence band is wide, which shows that there is a
lot of uncertainty around the predicted values. This means pizza
restaurant count alone does not explain much of the variation in rat
sightings across the city. The R squared value of 0.07 means that the
number of pizza restaurants in these zipcodes explains only about seven
percent of the variation in rat sighting reports. This shows that the
relationship between these two variables is very weak. While there is a
small positive trend, most of the differences in rat activity across
zipcodes are due to other factors that are not included in this
model.</p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
